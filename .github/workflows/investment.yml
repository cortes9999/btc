name: Investment Automation

on:
  schedule:
    # BTC semanal – lunes
    - cron: "0 14 * * 1"

    # Portafolio mensual – día 1 de cada mes
    - cron: "0 14 1 * *"

  workflow_dispatch:
    inputs:
      run_mode:
        description: "btc | portafolio | all"
        required: true
        default: "all"

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
      # =========================
      # CHECKOUT
      # =========================
      - name: Checkout repository
        uses: actions/checkout@v3

      # =========================
      # PYTHON
      # =========================
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: pip install -r requirements.txt

      # =========================
      # BTC – SEMANAL O MANUAL
      # =========================
      - name: BTC weekly
        if: |
          (github.event_name == 'workflow_dispatch' &&
           (inputs.run_mode == 'btc' || inputs.run_mode == 'all'))
          ||
          (github.event_name == 'schedule' &&
           github.event.schedule == '0 14 * * 1')
        run: python runners/run_btc_weekly.py
        env:
          PYTHONPATH: ${{ github.workspace }}
          EMAIL_USER: ${{ secrets.EMAIL_USER }}
          EMAIL_PASS: ${{ secrets.EMAIL_PASS }}
          EMAIL_TO:   ${{ secrets.EMAIL_TO }}

      # =========================
      # PORTAFOLIO – MENSUAL O MANUAL
      # =========================
      - name: portafolio monthly
        if: |
          (github.event_name == 'workflow_dispatch' &&
           (inputs.run_mode == 'portafolio' || inputs.run_mode == 'all'))
          ||
          (github.event_name == 'schedule' &&
           github.event.schedule == '0 14 1 * *')
        run: python runners/run_portfolio_monthly.py
        env:
          PYTHONPATH: ${{ github.workspace }}
          EMAIL_USER: ${{ secrets.EMAIL_USER }}
          EMAIL_PASS: ${{ secrets.EMAIL_PASS }}
          EMAIL_TO:   ${{ secrets.EMAIL_TO }}
